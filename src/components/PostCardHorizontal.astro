---
// src/components/PostCardHorizontal.astro
// 這是首頁「最新文章」專用的橫式卡片
import type { CollectionEntry } from 'astro:content';

interface Props {
  post: CollectionEntry<'blog'>;
}

const { post } = Astro.props;

const formatDate = (date: Date) => {
  const d = new Date(date);
  return `${d.getFullYear()}/${String(d.getMonth() + 1).padStart(2, '0')}/${String(d.getDate()).padStart(2, '0')}`;
};
---

<article class="bg-[var(--bg-card)] rounded-xl shadow-md flex items-center p-4 hover:shadow-lg transition-all duration-300 group">
  
  <!-- 1. 左側圖片 (固定大小) -->
  <div class="w-24 h-24 flex-shrink-0 overflow-hidden border border-[var(--border-color)] mr-4 rounded-lg">
    <a href={`/blog/${post.slug}`} class="block w-full h-full">
      <img 
        src={post.data.previewImage} 
        alt={post.data.title} 
        class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105" 
      />
    </a>
  </div>
  
  <!-- 2. 右側內容 -->
  <div class="flex-1 flex flex-col min-w-0">
    
    <!-- 分類 -->
    <div class="mb-2 flex flex-wrap gap-1 justify-end">
      {post.data.category.map(cat => (
        <a href={`/category/${cat}`} class="text-xs font-medium text-white bg-[var(--accent-color)] py-1 px-2 rounded-full hover:bg-[var(--accent-hover)] transition-colors">
          {cat}
        </a>
      ))}
    </div>

    <!-- 標題與摘要 -->
    <div class="flex-grow">
      <h3 class="text-base font-bold text-[var(--text-primary)] mb-1 line-clamp-1">
        <a href={`/blog/${post.slug}`} class="hover:text-[var(--accent-color)] transition-colors">
          {post.data.title}
        </a>
      </h3>
      <p class="text-sm text-[var(--text-secondary)] line-clamp-1 mb-2">{post.data.description}</p>
    </div>

    <!-- 
       ★ 底部資訊區 (日期 + Tags + 閱讀按鈕)
    -->
    <div class="flex items-center justify-between text-xs text-gray-500 gap-3 h-6 overflow-hidden"> <!-- 加入 h-6 overflow-hidden 保護整個底部不被撐開 -->
      
      <!-- 左邊群組：日期 + Tags -->
      <div class="flex items-center gap-2 flex-1 min-w-0">
        
        <!-- 日期 (不准縮小) -->
        <span class="flex-shrink-0 whitespace-nowrap">{formatDate(post.data.publishDate)}</span>
        
        <!-- 
           ★ 修改重點：Tags 容器
           1. flex-wrap: 允許 Tag 換行 (關鍵！)
           2. h-6: 固定高度，只顯示一行 (約 24px，足夠容納 text-xs 的 tag)
           3. overflow-hidden: 超出第一行的 Tag 會被隱藏
           4. content-center: 讓內容垂直置中
        -->
        <div class="flex flex-wrap gap-1 h-6 overflow-hidden content-center">
          {post.data.tags?.map(tag => (
            <a 
              href={`/archive?q=${encodeURIComponent(tag)}`}
              class="px-2 py-0.5 rounded-md text-gray-700 bg-[#e7f0e2] hover:bg-[var(--accent-color)] hover:text-white transition-colors cursor-pointer whitespace-nowrap flex-shrink-0"
            >
              {tag}
            </a>
          ))}
        </div>
      </div>

      <!-- 右邊按鈕：閱讀更多 (靠右) -->
      <a href={`/blog/${post.slug}`} class="text-[var(--accent-color)] hover:underline ml-auto flex-shrink-0 self-center">
        閱讀 &rarr;
      </a>

    </div>
  </div>
</article>
