---
// src/components/PostCardHorizontal.astro
// 這是首頁「最新文章」專用的橫式卡片 (已修正Tag佈局與尺寸)
import type { CollectionEntry } from 'astro:content';

interface Props {
  post: CollectionEntry<'blog'>;
}

const { post } = Astro.props;

const formatDate = (date: Date) => {
  const d = new Date(date);
  return `${d.getFullYear()}/${String(d.getMonth() + 1).padStart(2, '0')}/${String(d.getDate()).padStart(2, '0')}`;
};

// 決定 Tags 顯示數量 (手機只顯示 2 個，電腦顯示 5 個)
const visibleTagCount = 5; // 電腦版顯示數量
---

<article class="bg-[var(--bg-card)] rounded-xl shadow-md flex items-center p-4 hover:shadow-lg transition-all duration-300 group">
  
  <!-- 1. 左側圖片 (固定大小) -->
  <div class="w-24 h-24 flex-shrink-0 overflow-hidden border border-[var(--border-color)] mr-4 rounded-lg">
    <a href={`/blog/${post.slug}`} class="block w-full h-full">
      <img 
        src={post.data.previewImage} 
        alt={post.data.title} 
        class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105" 
      />
    </a>
  </div>
  
  <!-- 2. 右側內容 -->
  <div class="flex-1 flex flex-col min-w-0">
    
    <!-- 
       ★ 修正 3：分類尺寸 (手機版更小)
       將 text-xs 改為 xs:text-xs，並加入 text-[10px] 鎖定手機的尺寸
    -->
    <div class="mb-2 flex flex-wrap gap-1 justify-end">
      {post.data.category.map(cat => (
        <a 
          href={`/category/${cat}`} 
          class="text-[10px] xs:text-xs font-medium text-white bg-[var(--accent-color)] py-0.5 px-1.5 rounded-full hover:bg-[var(--accent-hover)] transition-colors"
        >
          {cat}
        </a>
      ))}
    </div>

    <!-- 標題與摘要 -->
    <div class="flex-grow">
      <h3 class="text-base font-bold text-[var(--text-primary)] mb-1 line-clamp-1">
        <a href={`/blog/${post.slug}`} class="hover:text-[var(--accent-color)] transition-colors">
          {post.data.title}
        </a>
      </h3>
      <p class="text-sm text-[var(--text-secondary)] line-clamp-1 mb-2">{post.data.description}</p>
    </div>

    <!-- 
       ★ 底部資訊區 (Tags + 日期)
    -->
    <div class="flex items-center justify-between text-xs text-gray-500 gap-3">
      
      <!-- 
         ★ 修正 2：將 Tags 提到最前面 
         Tags 容器 (手機顯示 2 個，電腦顯示 5 個)
      -->
      <div class="flex items-center gap-1 flex-1 min-w-0 overflow-hidden">
        
        <!-- 
           使用 slice() 實現寫死數量，確保手機版絕對不破版 
           手機只顯示前 2 個，電腦顯示到 5 個 (避免 Tag 太多)
        -->
        {post.data.tags?.slice(0, 2).map(tag => (
          <a 
            href={`/archive?q=${encodeURIComponent(tag)}`}
            class="px-1.5 text-xs text-gray-500 hover:text-[var(--accent-color)] hover:underline transition-colors cursor-pointer whitespace-nowrap flex-shrink-0 hidden xs:inline-block"
          >
            #{tag}
          </a>
        ))}
        {post.data.tags?.slice(2, visibleTagCount).map(tag => (
          <a 
            href={`/archive?q=${encodeURIComponent(tag)}`}
            class="px-1.5 text-xs text-gray-500 hover:text-[var(--accent-color)] hover:underline transition-colors cursor-pointer whitespace-nowrap flex-shrink-0 hidden sm:inline-block"
          >
            #{tag}
          </a>
        ))}
        
        <!-- 
           ★ 修正 2：日期移動到 Tags 後方 
           加上 ml-auto md:ml-2，讓日期在手機上和 Tags 隔開
        -->
        <span class="flex-shrink-0 whitespace-nowrap ml-auto md:ml-2 text-gray-400">
            {formatDate(post.data.publishDate)}
        </span>
      </div>

      <!-- 右邊按鈕：閱讀更多 (靠右) -->
      <a href={`/blog/${post.slug}`} class="text-[var(--accent-color)] hover:underline ml-auto flex-shrink-0">
        閱讀 &rarr;
      </a>

    </div>
  </div>
</article>
