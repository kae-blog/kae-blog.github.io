---
// 檔案路徑: src/components/Sidebar.astro (修改)
import { getCollection } from 'astro:content';

const allPosts = await getCollection('blog');
const totalCount = allPosts.length;

// 1. 建立一個 Map 來計算每個分類有幾篇文章
// (例如: {'日本留學' => 1, '精選文章' => 1})
const categoryCounts = new Map<string, number>();
allPosts.flatMap(post => post.data.category).forEach(cat => {
  categoryCounts.set(cat, (categoryCounts.get(cat) || 0) + 1);
});
---
<aside class="md:col-span-1 space-y-8">
    
    <div class="bg-[var(--bg-card)] p-6 rounded-xl shadow-lg text-center">
        <img src="https://i.postimg.cc/Z5xySH6x/da-tou-zhao.png" alt="かえ (KAE) 的大頭照" class="w-32 mb-4 mx-auto">
        <h3 class="text-2xl font-bold text-[var(--text-primary)] mb-2">かえ (KAE)</h3>
        <p class="text-[var(--text-secondary)] text-base leading-relaxed px-2">
            KAE です！ 這個部落格會來記錄我即將展開的日本交換生活，也會分享留學的事前申請、日本旅遊等經驗。
        </p>
        <a href="/about" class="text-sm font-semibold text-[var(--accent-color)] hover:text-[var(--accent-hover)] transition-colors mt-4 inline-block">
            閱讀更多關於我 &rarr;
        </a>
    </div>
    
    <div class="bg-[var(--bg-card)] p-6 rounded-xl shadow-lg">
        <h3 class="text-xl font-bold text-[var(--text-primary)] mb-4">文章分類</h3>
        <ul class="space-y-2">
            <li>
                <a href="/archive" class="block text-[var(--text-secondary)] hover:text-[var(--accent-color)] transition-colors">
                    所有文章 ({totalCount})
                </a>
            </li>
            {Array.from(categoryCounts.entries()).map(([category, count]) => (
                <li>
                    <a href={`/category/${category}`} class="block text-[var(--text-secondary)] hover:text-[var(--accent-color)] transition-colors">
                        {category} ({count})
                    </a>
                </li>
            ))}
        </ul>
    </div>

</aside>
