---
// æª”æ¡ˆè·¯å¾‘: src/components/Sidebar.astro (å·²å°‡æ¨™é¡Œæ”¹ç‚ºé€£çµ)
import { getCollection } from 'astro:content';
import author from '../data/author.json';
const allPosts = (await getCollection('blog')).filter(post => !post.data.draft);
const totalCount = allPosts.length;

// 1. å»ºç«‹ä¸€å€‹ Map ä¾†è¨ˆç®—æ¯å€‹åˆ†é¡žæœ‰å¹¾ç¯‡æ–‡ç« 
// (ä¾‹å¦‚: {'æ—¥æœ¬ç•™å­¸' => 1, 'ç²¾é¸æ–‡ç« ' => 1})
const categoryCounts = new Map<string, number>();
allPosts.flatMap(post => post.data.category).forEach(cat => {
  categoryCounts.set(cat, (categoryCounts.get(cat) || 0) + 1);
});
---
<aside class="md:col-span-1 space-y-8">
    
    <div class="bg-[var(--bg-card)] p-6 rounded-xl shadow-lg">
        
        <!-- 
           ðŸ‘‡ ä¿®æ­£ï¼šå°‡ H3 æ¨™ç±¤æ›¿æ›æˆé€£çµï¼Œä¸¦åŠ ä¸Šæ¨£å¼
           é»žæ“Šå¾Œæœƒé€£çµåˆ° /archive (æ‰€æœ‰æ–‡ç« )
        -->
        <a href="/archive" class="text-xl font-bold text-[var(--text-primary)] mb-4 hover:text-[var(--accent-color)] transition-colors flex items-center justify-between">
            æ–‡ç« åˆ†é¡ž 
            <span class="text-sm text-[var(--text-secondary)] hover:text-[var(--accent-color)]">&rarr;</span>
        </a>
        
        <ul class="space-y-2 mt-4"> <!-- åŠ ä¸Š mt-4 è®“åˆ—è¡¨èˆ‡æ¨™é¡Œæœ‰è¶³å¤ é–“è· -->
            <li>
                <!-- ä¿æŒæ‰€æœ‰æ–‡ç« é€£çµ (ç¾åœ¨æ˜¯æ¬¡ç´šé€£çµ) -->
                <a href="/archive" class="block text-[var(--text-secondary)] hover:text-[var(--accent-color)] transition-colors">
                    æ‰€æœ‰æ–‡ç«  ({totalCount})
                </a>
            </li>
            {Array.from(categoryCounts.entries()).map(([category, count]) => (
                <li>
                    <a href={`/category/${category}`} class="block text-[var(--text-secondary)] hover:text-[var(--accent-color)] transition-colors">
                        {category} ({count})
                    </a>
                </li>
            ))}
        </ul>
    </div>

</aside>
