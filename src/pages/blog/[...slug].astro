---
// src/pages/blog/[...slug].astro (已移除多餘的 "D")
import { getCollection, type CollectionEntry } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

export async function getStaticPaths() {
  const allPosts = await getCollection('blog');
  return allPosts.map(post => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

type Props = {
  post: CollectionEntry<'blog'>;
}
const { post } = Astro.props;
const { Content, headings } = await post.render();
---
<BaseLayout 
  pageTitle={post.data.title}
  description={post.data.description}
>
    
    <div class="max-w-3xl mx-auto">
        <article class="bg-[var(--bg-card)] rounded-xl shadow-lg p-8 md:p-12">
            
            <header class="mb-8">
                              <div class="mb-4 flex flex-wrap gap-2">
                  {post.data.category.map(cat => (
                    <a href={`/category/${cat}`} class="text-sm font-medium text-white bg-[var(--accent-color)] py-1 px-3 rounded-full hover:bg-[var(--accent-hover)] transition-colors">
                      {cat}
                    </a>
                  ))}
                </div>

                <h1 class="text-3xl md:text-4xl font-bold text-[var(--text-primary)] leading-tight mb-4 whitespace-pre-line">
                    {post.data.title}
                </h1>
                <span class="text-base text-gray-500">
                    {new Date(post.data.publishDate).toLocaleDateString('zh-TW')}・由 かえ (KAE) 撰寫
                </span>
                {post.data.tags && post.data.tags.length > 0 && (
                    <div class="mt-4 flex flex-wrap gap-2">
                        {post.data.tags.slice(0, 6).map(tag => (
                            <span class="text-xs font-medium text-[var(--text-secondary)] bg-gray-100 py-1 px-3 rounded-full">
                                # {tag}
                            </span>
                        ))}
                    </div>
                )}
            </header>

            {headings.filter(h => h.depth === 2 || h.depth === 3).length > 0 && (
                <div class="bg-gray-100 p-6 rounded-lg mb-8 border border-[var(--border-color)]">
                    <h2 class="text-xl font-bold text-[var(--text-primary)] mb-4">文章目次</h2>
                    <ul class="space-y-2">
                        {headings
                            .filter(h => h.depth === 2 || h.depth === 3)
                            .map(heading => (
                                <li class={heading.depth === 3 ? 'ml-4' : ''}>
                                    <a 
                                        href={`#${heading.slug}`}s
                                        class="text-[var(--text-secondary)] hover:text-[var(--accent-color)] transition-colors"
                                    >
                                        {heading.text}
                                    </a>
                                </li>
                            ))
                </div>     }
                    </ul>
                </div>
SESSION         )}
            <div class="prose max-w-none">
                <Content />
            </div>

        </article>
    </div>
</BaseLayout>
