---
import { getCollection } from 'astro:content';
import { Astro } from 'astro';

const { category } = Astro.params;

const allPosts = await getCollection('blog');

// 過濾包含該分類的文章
const filteredPosts = allPosts
  .filter(post => post.data.category?.includes(category))
  .sort((a, b) => new Date(b.data.publishDate) - new Date(a.data.publishDate));
---

<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{category} - KAE的雜記</title>
  <link rel="stylesheet" href="/_astro/global.css" />
</head>
<body class="bg-[var(--bg-main)]">

<header class="bg-[var(--bg-card)] shadow-sm border-b border-[var(--border-color)] sticky top-0 z-50">
  <div class="container mx-auto px-6 py-4 flex flex-wrap md:flex-nowrap justify-between items-center">
    <a href="/" class="flex items-center space-x-3">
      <img src="https://i.postimg.cc/Z5xySH6x/da-tou-zhao.png" alt="KAE 的大頭照" class="w-10 h-10 mx-auto">
      <h1 class="text-2xl md:text-3xl font-bold text-[var(--text-primary)]">KAE的雜記</h1>
    </a>
    <nav class="hidden md:flex space-x-6">
      <a href="/" class="text-[var(--text-secondary)] hover:text-[var(--accent-color)]">首頁</a>
      <a href="/about" class="text-[var(--text-secondary)] hover:text-[var(--accent-color)]">關於我</a>
    </nav>
  </div>
</header>

<main class="container mx-auto px-6 py-12">
  <h2 class="text-3xl font-bold text-[var(--text-primary)] mb-6 pb-3 border-b border-[var(--border-color)]">{category} 文章</h2>

  {filteredPosts.length === 0 ? (
    <p class="text-[var(--text-secondary)]">目前尚無此分類文章。</p>
  ) : (
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-2 gap-6">
      {filteredPosts.map(post => (
        <article class="bg-[var(--bg-card)] rounded-xl shadow-md hover:shadow-lg transition-all duration-300 overflow-hidden flex">
          <div class="w-24 h-24 flex-shrink-0 overflow-hidden border border-[var(--border-color)] mr-4 rounded-lg">
            <img src={post.data.previewImage} alt={post.data.title} class="w-full h-full object-cover" />
          </div>
          <div class="p-4 flex-1">
            <h3 class="text-base sm:text-lg font-bold text-[var(--text-primary)] mb-1 line-clamp-2">
              <a href={`/blog/${post.slug}`} class="hover:text-[var(--accent-color)] transition-colors">{post.data.title}</a>
            </h3>
            <p class="text-sm text-[var(--text-secondary)] line-clamp-2 mb-2">{post.data.description}</p>
            <div class="flex flex-wrap items-center justify-between text-xs text-gray-500 gap-2">
              <span>{post.data.publishDate}</span>
              <div class="flex flex-wrap gap-1">
                {post.data.category?.slice(0,3).map(cat => (
                  <span class="px-2 py-0.5 rounded-md text-gray-700" style="background-color:#e7f0e2;">{cat}</span>
                ))}
              </div>
              <a href={`/blog/${post.slug}`} class="text-[var(--accent-color)] hover:underline ml-auto">閱讀 →</a>
            </div>
          </div>
        </article>
      ))}
    </div>
  )}
</main>

<footer class="text-center text-[var(--text-secondary)] py-10 mt-12 border-t border-[var(--border-color)]">
  <p>&copy; 2025 KAE的雜記. All rights reserved.</p>
</footer>

</body>
</html>
