---
// src/pages/index.astro
import BaseLayout from '../layouts/BaseLayout.astro';
import Sidebar from '../components/Sidebar.astro';
import { getCollection } from 'astro:content';

const allPosts = await getCollection('blog');
allPosts.sort((a, b) => new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime());
---
<BaseLayout>
    
    <div class="grid grid-cols-1 md:grid-cols-3 gap-10 lg:gap-12">
        
        <div class="md:col-span-2">
            
            <h2 class="text-3xl font-bold text-[var(--text-primary)] mb-6 pb-3 border-b border-[var(--border-color)]">最新文章</h2>

            {allPosts.map(post => (
                <article class="bg-[var(--bg-card)] rounded-xl shadow-lg overflow-hidden mb-8 flex flex-row transition-all duration-300 hover:shadow-xl">
                    
                    <div class="p-6 md:p-8 flex-1">
                        <div class="mb-2">
                            <span class="text-sm font-medium text-white bg-[var(--accent-color)] py-1 px-3 rounded-full">{post.data.category}</span>
                        </div>
                        <h3 class="text-lg font-bold text-[var(--text-primary)] mb-3">
                            <a href={`/blog/${post.slug}`} class="hover:text-[var(--accent-color)] transition-colors whitespace-pre-line">{post.data.title}</a>
                        </h3>
                        <p class="text-[var(--text-secondary)] text-base leading-relaxed mb-4 line-clamp-2">
                            {post.data.description}
                        </p>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-500">{new Date(post.data.publishDate).toLocaleDateString('zh-TW')}</span>
                            <a href={`/blog/${post.slug}`} class="text-base font-semibold text-[var(--accent-color)] hover:text-[var(--accent-hover)] transition-colors">
                                繼續閱讀 &rarr;
                            </a>
                        </div>
                    </div>

                    <div class="w-1/3 max-w-[120px] flex-shrink-0">
                        <img src={post.data.previewImage} alt="文章預覽圖" class="w-full h-full object-cover">
                    </div>
                </article>
            ))}

        </div>

        <Sidebar />

    </div>
</BaseLayout>
