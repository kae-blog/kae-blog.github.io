---
// src/pages/index.astro (å·²å…¨é¢æ›ç”¨å…ƒä»¶)
import BaseLayout from '../layouts/BaseLayout.astro';
import Sidebar from '../components/Sidebar.astro';
// ğŸ‘‡ 1. å¼•å…¥å…©ç¨®å¡ç‰‡å…ƒä»¶
import PostCard from '../components/PostCard.astro';
import PostCardHorizontal from '../components/PostCardHorizontal.astro';
import { getCollection } from 'astro:content';

// 2. æŠ“å–ä¸¦éæ¿¾è‰ç¨¿
const allPosts = (await getCollection('blog'))
  .filter(post => !post.data.draft);

// 3. ç¯©é¸ã€Œç²¾é¸æ–‡ç« ã€ (ç”¨æ–¼ä¸‹æ–¹ç¶²æ ¼)
const featuredPosts = allPosts
  .filter(post => post.data.category?.includes('ç²¾é¸æ–‡ç« '))
  .sort((a, b) => new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime())
  .slice(0, 6);

// 4. ç¯©é¸ã€Œæœ€æ–°æ–‡ç« ã€ (ç”¨æ–¼ä¸Šæ–¹åˆ—è¡¨)
const latestPosts = allPosts
  .sort((a, b) => new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime())
  .slice(0, 5);
---

<BaseLayout 
  description="KAEçš„é›œè¨˜ - æ—¥æœ¬ç•™å­¸èˆ‡ç”Ÿæ´»ã€‚ä¸€å€‹ç´€éŒ„æ—¥æœ¬äº¤æ›ã€æ—…éŠèˆ‡éš¨ç­†çš„éƒ¨è½æ ¼ã€‚"
>
  <div class="grid grid-cols-1 md:grid-cols-3 gap-10 lg:gap-12">
    <div class="md:col-span-2 space-y-12">

      <!-- 
        å€å¡Šä¸€ï¼šæœ€æ–°æ–‡ç«  (ä½¿ç”¨æ©«å¼å¡ç‰‡ PostCardHorizontal)
        ä¿æŒåˆ—è¡¨å½¢å¼ (space-y-4)
      -->
      <section>
        <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-6 pb-3 border-b border-[var(--border-color)]">æœ€æ–°æ–‡ç« </h2>
        <div class="space-y-4">
          {latestPosts.map(post => (
            <PostCardHorizontal post={post} />
          ))}
        </div>
        <div class="text-right mt-4">
          <a href="/archive" class="text-[var(--accent-color)] hover:underline font-semibold">æŸ¥çœ‹æ‰€æœ‰æ–‡ç«  &rarr;</a>
        </div>
      </section>

      <!-- 
        å€å¡ŠäºŒï¼šç²¾é¸æ–‡ç«  (ä½¿ç”¨æ–¹å½¢å¡ç‰‡ PostCard)
        ä¿æŒç¶²æ ¼å½¢å¼ (grid-cols-1 sm:grid-cols-2)
      -->
      <section>
        <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-6 pb-3 border-b border-[var(--border-color)]">ç²¾é¸æ–‡ç« </h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
          {featuredPosts.map(post => (
            <div class="h-full"> <!-- åŠ ä¸Š h-full ç¢ºä¿å¡ç‰‡é«˜åº¦ä¸€è‡´ -->
              <PostCard post={post} />
            </div>
          ))}
        </div>
        <div class="text-right mt-4">
          <a href="/category/ç²¾é¸æ–‡ç« " class="text-[var(--accent-color)] hover:underline font-semibold">æŸ¥çœ‹æ›´å¤šç²¾é¸æ–‡ç«  &rarr;</a>
        </div>
      </section>

    </div>

    <!-- å´é‚Šæ¬„ -->
    <Sidebar />
  </div>
</BaseLayout>
